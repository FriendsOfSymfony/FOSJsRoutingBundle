"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol?"symbol":typeof obj};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var instance=null;var Router=function(){function Router(context,routes){_classCallCheck(this,Router);instance=this;this.context_=context||{base_url:"",prefix:"",host:"",scheme:""};this.setRoutes(routes||{})}_createClass(Router,[{key:"setRoutes",value:function setRoutes(routes){this.routes_=Object.freeze(routes)}},{key:"getRoutes",value:function getRoutes(){return this.routes_}},{key:"setBaseUrl",value:function setBaseUrl(baseUrl){this.context_.base_url=baseUrl}},{key:"getBaseUrl",value:function getBaseUrl(){return this.context_.base_url}},{key:"setPrefix",value:function setPrefix(prefix){this.context_.prefix=prefix}},{key:"setScheme",value:function setScheme(scheme){this.context_.scheme=scheme}},{key:"getScheme",value:function getScheme(){return this.context_.scheme}},{key:"setHost",value:function setHost(host){this.context_.host=host}},{key:"getHost",value:function getHost(){return this.context_.host}},{key:"buildQueryParams",value:function buildQueryParams(prefix,params,add){var _this=this;var name=void 0;var rbracket=new RegExp(/\[\]$/);if(params instanceof Array){params.forEach(function(val,i){if(rbracket.test(prefix)){add(prefix,val)}else{_this.buildQueryParams(prefix+"["+((typeof val==="undefined"?"undefined":_typeof(val))==="object"?i:"")+"]",val,add)}})}else if((typeof params==="undefined"?"undefined":_typeof(params))==="object"){for(name in params){this.buildQueryParams(prefix+"["+name+"]",params[name],add)}}else{add(prefix,params)}}},{key:"getRoute",value:function getRoute(name){var prefixedName=this.context_.prefix+name;if(!(prefixedName in this.routes_)){if(!(name in this.routes_)){throw new Error('The route "'+name+'" does not exist.')}}else{name=prefixedName}return this.routes_[name]}},{key:"generate",value:function generate(name,opt_params,absolute){var _this2=this;var route=this.getRoute(name),params=opt_params||{},unusedParams=Object.assign({},params),url="",optional=true,host="";route.tokens.forEach(function(token){if("text"===token[0]){url=token[1]+url;optional=false;return}if("variable"===token[0]){var hasDefault=route.defaults&&token[3]in route.defaults;if(false===optional||!hasDefault||token[3]in params&&params[token[3]]!=route.defaults[token[3]]){var value=void 0;if(token[3]in params){value=params[token[3]];delete unusedParams[token[3]]}else if(hasDefault){value=route.defaults[token[3]]}else if(optional){return}else{throw new Error('The route "'+name+'" requires the parameter "'+token[3]+'".')}var empty=true===value||false===value||""===value;if(!empty||!optional){var encodedValue=encodeURIComponent(value).replace(/%2F/g,"/");if("null"===encodedValue&&null===value){encodedValue=""}url=token[1]+encodedValue+url}optional=false}else if(hasDefault&&token[3]in unusedParams){delete unusedParams[token[3]]}return}throw new Error('The token type "'+token[0]+'" is not supported.')});if(url===""){url="/"}route.hosttokens.forEach(function(token){var value=void 0;if("text"===token[0]){host=token[1]+host;return}if("variable"===token[0]){if(token[3]in params){value=params[token[3]];delete unusedParams[token[3]]}else if(route.defaults&&token[3]in route.defaults){value=route.defaults[token[3]]}host=token[1]+value+host}});url=this.context_.base_url+url;if(route.requirements&&"_scheme"in route.requirements&&this.getScheme()!=route.requirements["_scheme"]){url=route.requirements["_scheme"]+"://"+(host||this.getHost())+url}else if(host&&this.getHost()!==host){url=this.getScheme()+"://"+host+url}else if(absolute===true){url=this.getScheme()+"://"+this.getHost()+url}if(Object.keys(unusedParams).length>0){(function(){var prefix=void 0;var queryParams=[];var add=function add(key,value){value=typeof value==="function"?value():value;value=value===null?"":value;queryParams.push(encodeURIComponent(key)+"="+encodeURIComponent(value))};for(prefix in unusedParams){_this2.buildQueryParams(prefix,unusedParams[prefix],add)}url=url+"?"+queryParams.join("&").replace(/%20/g,"+")})()}return url}}],[{key:"getInstance",value:function getInstance(){return instance||new Router}},{key:"setData",value:function setData(data){var router=Router.getInstance();router.setBaseUrl(data["base_url"]);router.setRoutes(data["routes"]);if("prefix"in data){router.setPrefix(data["prefix"])}router.setHost(data["host"]);router.setScheme(data["scheme"])}}]);return Router}();Router.Route;Router.Context;if(typeof window.define==="function"&&window.define.amd){window.define("Router",[],function(){return Router})}else if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){module.exports=Router}}else{if(typeof window.fos==="undefined"){window.fos={}}window.fos.Router=Router}